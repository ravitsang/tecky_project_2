<div class="fn fo fp fq fr fs ag ft ah fu aj ak"><figure class="fw fx fy fz ga fm gb gc paragraph-image"><div class="gd ge gf gg ak"><div class="cl cm fv"><div class="gm r gf gn"><div class="go r"><div class="gh gi cp t u gj ak eh gk gl"><img class="cp t u gj ak gp gq gr" src="https://miro.medium.com/max/60/1*IRKtkTpZ5B4ZXU0aLuQ9GA.jpeg?q=20" width="2952" height="1080" role="presentation"></div><img class="gh gi cp t u gj ak gs" width="2952" height="1080" role="presentation"><noscript><img class="cp t u gj ak" src="https://miro.medium.com/max/5904/1*IRKtkTpZ5B4ZXU0aLuQ9GA.jpeg" width="2952" height="1080" role="presentation"></noscript></div></div></div></div><figcaption class="bo eg gt gu gv cn cl cm gw gx bj ef">Link previews</figcaption></figure></div><p id="6380" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">Have you ever wondered how do web applications preview a link once you‚Äôve posted it on your timeline or send a message ?, I‚Äôve been to the sun and back multiple times trying to figure it out.</p><p id="bc50" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">I had many questions that needed to be answered, but it was either no one understood what I asked or I was asking the wrong questions.</p><p id="4c22" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">Worrest answers I‚Äôve received were ‚Äúyou can use a web scraper API tool to achieve it, that‚Äôs what I used in my project‚Äù.</p><p id="494d" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">Services like</p><ul class=""><li id="870d" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl hm hn ho"><a href="https://www.linkpreview.net/" class="at cg hp hq hr hs" target="_blank" rel="noopener nofollow">Linkpreview</a></li><li id="04e2" class="gy gz dc bk ha b hb ht hd hu hf hv hh hw hj hx hl hm hn ho"><a href="https://www.scraperapi.com/" class="at cg hp hq hr hs" target="_blank" rel="noopener nofollow">Scraperapi</a></li><li id="6083" class="gy gz dc bk ha b hb ht hd hu hf hv hh hw hj hx hl hm hn ho"><a href="https://www.scrapesimple.com/" class="at cg hp hq hr hs" target="_blank" rel="noopener nofollow">Scrapesimple</a></li><li id="a447" class="gy gz dc bk ha b hb ht hd hu hf hv hh hw hj hx hl hm hn ho"><a href="https://guteurls.de/" class="at cg hp hq hr hs" target="_blank" rel="noopener nofollow">Guteurls</a></li></ul><p id="9adf" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">A few more‚Ä¶..</p><p id="ce54" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">Until one day I met a guardian angel and I was introduced to <a href="https://ogp.me/" class="at cg hp hq hr hs" target="_blank" rel="noopener nofollow">open graph protocol</a>.</p><p id="ab45" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">Thank you, Emma ü§ó.</p><p id="03f1" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">FYI ‚Äî The correct word for what we are doing is called web scraping</p><h1 id="c978" class="hy hz dc bk bj ia de ib dg ic id ie if ig ih ii ij">What is open graph protocol ?</h1><blockquote class="ik il im"><p id="7ec7" class="gy gz dc in ha b hb hc hd he hf hg hh hi hj hk hl cu">The Open Graph protocol enables any web page to become a rich object in a social graph. For instance, this is used on Facebook to allow any web page to have the same functionality as any other object on Facebook.</p><p id="68b6" class="gy gz dc in ha b hb hc hd he hf hg hh hi hj hk hl cu">~ Someone from <a href="https://ogp.me/" class="at cg hp hq hr hs" target="_blank" rel="noopener nofollow">https://ogp.me/</a></p></blockquote><p id="abc7" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">In short, it describes a website with objects like title, description, images, and more with <code class="gn io ip iq ir b">&lt;meta&gt;</code> tags.</p><p id="21f3" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">I‚Äôm not here to talk about open graph protocol, I‚Äôm here to show you how to fetch those data to make your own link preview, so if you want to know more about OGP, here are a couple of links.</p><p id="e207" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">FYI ‚Äî Twitter has its own meta tag, but they use the ‚Äútwitter‚Äù prefix instead of ‚Äúog‚Äù</p><div class="is it iu iv iw ix"><a href="https://www.computerhope.com/jargon/o/open-graph.htm" rel="noopener nofollow"><div class="ja n ar"><div class="jb n co p jc jd"><h2 class="bj ia je bl dc"><div class="eh iy ej ek iz em">What is Open Graph?</div></h2><div class="jf r"><h3 class="bj ef eg bl bo"><div class="eh iy ej ek iz em">Open Graph is a technology first introduced by Facebook in 2010 that allows integration between Facebook and its user‚Ä¶</div></h3></div><div class="jg r"><h4 class="bj ef fb bl bo"><div class="eh iy ej ek iz em">www.computerhope.com</div></h4></div></div><div class="jh r"><div class="ji r jj jk jl jh jm jn jo"></div></div></div></a></div><div class="is it iu iv iw ix"><a rel="noopener" href="/better-programming/getting-meta-why-does-my-social-post-not-show-an-image-when-i-share-a-link-316b35b311e2"><div class="ja n ar"><div class="jb n co p jc jd"><h2 class="bj ia je bl dc"><div class="eh iy ej ek iz em">Getting Meta: Why Does My Social Post Not Show an Image When I Share a Link?</div></h2><div class="jf r"><h3 class="bj ef eg bl bo"><div class="eh iy ej ek iz em">How to fix this with The Open Graph protocol</div></h3></div><div class="jg r"><h4 class="bj ef fb bl bo"><div class="eh iy ej ek iz em">medium.com</div></h4></div></div><div class="jh r"><div class="jp r jj jk jl jh jm jn jo"></div></div></div></a></div><div class="is it iu iv iw ix"><a href="https://ogp.me/" rel="noopener nofollow"><div class="ja n ar"><div class="jb n co p jc jd"><h2 class="bj ia je bl dc"><div class="eh iy ej ek iz em">Open Graph protocol</div></h2><div class="jf r"><h3 class="bj ef eg bl bo"><div class="eh iy ej ek iz em">The Open Graph protocol enables any web page to become a rich object in a social graph. For instance, this is used on‚Ä¶</div></h3></div><div class="jg r"><h4 class="bj ef fb bl bo"><div class="eh iy ej ek iz em">ogp.me</div></h4></div></div><div class="jh r"><div class="jq r jj jk jl jh jm jn jo"></div></div></div></a></div><div class="is it iu iv iw ix"><a href="https://css-tricks.com/essential-meta-tags-social-media/" rel="noopener nofollow"><div class="ja n ar"><div class="jb n co p jc jd"><h2 class="bj ia je bl dc"><div class="eh iy ej ek iz em">The Essential Meta Tags for Social Media | CSS-Tricks</div></h2><div class="jf r"><h3 class="bj ef eg bl bo"><div class="eh iy ej ek iz em">These days, almost every website encourages visitors to share its pages on social media. We‚Äôve all seen the ubiquitous‚Ä¶</div></h3></div><div class="jg r"><h4 class="bj ef fb bl bo"><div class="eh iy ej ek iz em">css-tricks.com</div></h4></div></div><div class="jh r"><div class="jr r jj jk jl jh jm jn jo"></div></div></div></a></div><h1 id="07ef" class="hy hz dc bk bj ia de ib dg ic id ie if ig ih ii ij">How do we do it ?</h1><p id="0a7a" class="gy gz dc bk ha b hb js hd jt hf ju hh jv hj jw hl cu">It‚Äôs a simple process and doesn‚Äôt require much work, we will fetch the web page as text in our Node.js application. Then we will select the HTML elements we need and get the data/text it holds, save it to a JSON file then send the data back.</p><p id="ce08" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">‚ÄúBut how can we select the dom from the back end Adel ?‚Äù</p><p id="0537" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">Easy, with the help of cheerio and other modules like it, cheerio is a <em class="in">Fast, flexible, and lean implementation of core jQuery designed specifically for the server.</em></p><h1 id="d439" class="hy hz dc bk bj ia de ib dg ic id ie if ig ih ii ij">Can we do it on the front end ?</h1><p id="00e8" class="gy gz dc bk ha b hb js hd jt hf ju hh jv hj jw hl cu">As far as I know, you cant, this cant be done in the front end script, when you try to fetch eg my portfolio or any other site in chrome‚Äôs console, it will throw a cors (Cross-Origin Resource Sharing) error.</p><figure class="fw fx fy fz ga fm cl cm paragraph-image"><div class="cl cm jx"><div class="gm r gf gn"><div class="jy r"><div class="gh gi cp t u gj ak eh gk gl"><img class="cp t u gj ak gp gq gr" src="https://miro.medium.com/max/60/1*rAU9xQYpm2MTc8ZMASHWNA.jpeg?q=20" width="522" height="310" role="presentation"></div><img class="gh gi cp t u gj ak gs" width="522" height="310" role="presentation"><noscript><img class="cp t u gj ak" src="https://miro.medium.com/max/1044/1*rAU9xQYpm2MTc8ZMASHWNA.jpeg" width="522" height="310" role="presentation"></noscript></div></div></div></figure><p id="9093" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">To bypass this issue, we will send the URL to the back end server, process the request then send back the data we scrapped.</p><h1 id="fc59" class="hy hz dc bk bj ia de ib dg ic id ie if ig ih ii ij">Prerequisite</h1><ul class=""><li id="bc00" class="gy gz dc bk ha b hb js hd jt hf ju hh jv hj jw hl hm hn ho">JQuery, if you know how to select an element and get its values, your good.</li><li id="ed9a" class="gy gz dc bk ha b hb ht hd hu hf hv hh hw hj hx hl hm hn ho">Async/Await</li><li id="5868" class="gy gz dc bk ha b hb ht hd hu hf hv hh hw hj hx hl hm hn ho">NodeJS/ExpressJS</li></ul><h1 id="3638" class="hy hz dc bk bj ia de ib dg ic id ie if ig ih ii ij">OK LETS CODE!!!</h1><p id="e0ca" class="gy gz dc bk ha b hb js hd jt hf ju hh jv hj jw hl cu">If you want to tag along, I‚Äôve got starter files you can clone/download, and I‚Äôll be adding the completed files too.</p><div class="is it iu iv iw ix"><a href="https://github.com/Adel-ak/web-scraping-101" rel="noopener nofollow"><div class="ja n ar"><div class="jb n co p jc jd"><h2 class="bj ia je bl dc"><div class="eh iy ej ek iz em">Adel-ak/web-scraping-101</div></h2><div class="jf r"><h3 class="bj ef eg bl bo"><div class="eh iy ej ek iz em">You can‚Äôt perform that action at this time. You signed in with another tab or window. You signed out in another tab or‚Ä¶</div></h3></div><div class="jg r"><h4 class="bj ef fb bl bo"><div class="eh iy ej ek iz em">github.com</div></h4></div></div><div class="jh r"><div class="jz r jj jk jl jh jm jn jo"></div></div></div></a></div><p id="d978" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu"><strong class="ha ka">1 ‚Äî Get to know the front end script</strong></p><p id="b5a5" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">In our front end script located in the public/javascript folder has a fairly small amount of code in it, we have a click event listener on our add button, which will</p><ul class=""><li id="a5c0" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl hm hn ho">prepend a loading preview card with an id.</li><li id="d962" class="gy gz dc bk ha b hb ht hd hu hf hv hh hw hj hx hl hm hn ho">send a post request to the backend with the URL link and the card id which was added to the page.</li><li id="7bce" class="gy gz dc bk ha b hb ht hd hu hf hv hh hw hj hx hl hm hn ho">await for the data to come back, then add the data to the correct preview card but searching the id of the card.</li></ul><pre class="fw fx fy fz ga kb kc kd"><span id="82dd" class="ke hz dc bk ir b eg kf kg r kh">const addButton = document.querySelector('button');</span><span id="4aa3" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">addButton.addEventListener('click', async (e) =&gt; {</span><span id="312c" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">e.preventDefault();</span><span id="4f67" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">try {<br>    let urlInput = document.querySelector('input');<br>    const id = await uuid();<br>    const fetchData = {<br>             method: 'POST',<br>             headers: {<br>                 'Content-Type': 'application/json;charset=utf-8'<br>             },<br>            body: JSON.stringify({ previewUrl: urlInput.value, id })<br>    };</span><span id="637d" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">urlInput.value = '';</span><span id="c983" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">prependLoadingPreview(id);</span><span id="4571" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">const data = await fetch('/get-preview', fetchData)<br>     .then(res =&gt; res.json());<br>     <br>     addDataToPreview(data);</span><span id="a579" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">} catch (err) {</span><span id="6b58" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">console.log(err);</span><span id="c99e" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">}<br>});</span></pre><p id="9eb8" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">This function accepts an id and will add the loading preview to the unordered list,</p><pre class="fw fx fy fz ga kb kc kd"><span id="1f4e" class="ke hz dc bk ir b eg kf kg r kh">function prependLoadingPreview(id) {</span><span id="b7f5" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">document.querySelector(`ul`).prepend(document.createRange()<br>  .createContextualFragment(`&lt;li class="preview-container loading" data-id="${id}"&gt;&lt;/li&gt;`,'text/html'));</span><span id="08a1" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">}</span></pre><p id="f398" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">This function will receive an object, it will get the loading list by its id which was previously added, remove the loading class name then append the data</p><pre class="fw fx fy fz ga kb kc kd"><span id="0f2e" class="ke hz dc bk ir b eg kf kg r kh">Object example<br>{<br>  id: "a60d491d-8c70-4620-aa18-111ae1abaea9", <br>  url: "https://www.adelak.me", <br>  img:"https://www.npmjs.com/package/mongoose", <br>  title: "Mongoose", <br>  description: "Mongoose is a <a href="https://www.mongodb.org/" class="at cg hp hq hr hs" target="_blank" rel="noopener nofollow">MongoDB</a> object modeling tool designed to work in an asynchronous environment. Mongoose supports both promises and callbacks.", <br>  domain: "npmjs.com"<br>}</span><span id="cf46" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">function addDataToPreview({ id, url, img, title, description, domain }) {</span><span id="2057" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">const li = document.querySelector(`li[data-id="${id}"]`);</span><span id="de8a" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">li.classList.remove('loading');</span><span id="637a" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">li.innerHTML =</span><span id="02fc" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">`&lt;svg class="delete-button" viewBox="0 0 24 24" onClick="removePreview(this)"&gt;&lt;polygon points="17.8,16.7 16.6,17.9 12,13.3 7.4,17.9 6.2,16.7 10.8,12.1 6.2,7.5 7.4,6.3 12,11 16.6,6.4 17.8,7.6 13.2,12.2"&gt;&lt;/polygon&gt;&lt;/svg&gt;<br>&lt;a href="${url}" target="_blank"&gt;&lt;img class="preview-image" src="${img}" alt="preview image" onError="imgError(this)"/&gt;&lt;div class="preview-info"&gt;&lt;h5 class="preview-title"&gt;${title}&lt;/h5&gt;&lt;p class="preview-description"&gt;${description}&lt;/p&gt;&lt;span class="preview-url"&gt;${domain}&lt;/span&gt;&lt;/div&gt;&lt;/a&gt;`;</span><span id="3361" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">}</span></pre><p id="5364" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">This function removes a preview card</p><pre class="fw fx fy fz ga kb kc kd"><span id="d09f" class="ke hz dc bk ir b eg kf kg r kh">const removePreview = async (e) =&gt; {<br>  try{</span><span id="888c" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">let li = e.parentElement;</span><span id="86f0" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">li.parentElement.removeChild(li);</span><span id="ec42" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">const id = li.getAttribute('data-id');</span><span id="49e2" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">await fetch(`/remove/${id}`, { method: 'POST' });<br>  <br>  }catch(err){</span><span id="9394" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">console.log(err);</span><span id="4c99" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">}<br>}</span></pre><p id="1967" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">The UUID CDN was making the app load super slow, thanks to <a href="https://stackoverflow.com/users/109538" class="at cg hp hq hr hs" target="_blank" rel="noopener nofollow">broofa</a> who came up with this function, it will be creating our unique id for each preview card</p><pre class="fw fx fy fz ga kb kc kd"><span id="6f62" class="ke hz dc bk ir b eg kf kg r kh">function uuid(){</span><span id="07c5" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">let date = new Date().getTime();</span><span id="a21e" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">const randomStrings = (c) =&gt; {</span><span id="3859" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">const r = (date + Math.random()*16)%16 | 0;</span><span id="6a46" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">date = Math.floor(date/16);</span><span id="ce46" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">return (c=='x' ? r :(r&amp;0x3|0x8)).toString(16);</span><span id="a021" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">}</span><span id="466d" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">const id = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, randomStrings);</span><span id="b037" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">return id;</span><span id="3d4f" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">}</span></pre><p id="c4dc" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu"><strong class="ha ka">2 ‚Äî Installing modules</strong></p><p id="f784" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">We need to install a few modules.</p><p id="e925" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu"><strong class="ha ka">Cheerio </strong>to<strong class="ha ka"> </strong>load the source code of the webpage we want to crawl.</p><p id="fb8d" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu"><strong class="ha ka">ExpressJS</strong> to create our HTTP server.</p><p id="c0cc" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu"><strong class="ha ka">Express-handlebars</strong> a template engine that makes writing HTML code easier and renders out page.</p><p id="4ece" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu"><strong class="ha ka">Node-fetch </strong>to make our HTTP request in node.js.</p><p id="4df4" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">I‚Äôve added these modules to the dependencies, simply install them by running <code class="gn io ip iq ir b">npm i</code> in the command line.</p><p id="1469" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu"><strong class="ha ka">3 ‚Äî Creating our server</strong></p><p id="0e13" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">Over at app.js, we have requested all our modules, set up our view engine and middlewares.</p><p id="5fd7" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">We can start by creating the home route, which will render the home temple and passing it the data in <code class="gn io ip iq ir b">data.json</code> (currently, <code class="gn io ip iq ir b">data,json</code>is empty).</p><pre class="fw fx fy fz ga kb kc kd"><span id="ebd3" class="ke hz dc bk ir b eg kf kg r kh">app.get('/', function(req, res) {<br>   res.render('home.handlebars', { data });<br>});</span></pre><p id="7e2b" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">Open up a command line and run npm start, then in your browser open up localhost://3000.</p><p id="f120" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">You should get an empty home page, with just an input filed.</p><figure class="fw fx fy fz ga fm cl cm paragraph-image"><div class="gd ge gf gg ak"><div class="cl cm kn"><div class="gm r gf gn"><div class="ko r"><div class="gh gi cp t u gj ak eh gk gl"><img class="cp t u gj ak gp gq gr" src="https://miro.medium.com/max/60/1*EyrgqyH5r_ALEqdbfXhBVA.jpeg?q=20" width="1003" height="695" role="presentation"></div><img class="gh gi cp t u gj ak gs" width="1003" height="695" role="presentation"><noscript><img class="cp t u gj ak" src="https://miro.medium.com/max/2006/1*EyrgqyH5r_ALEqdbfXhBVA.jpeg" width="1003" height="695" role="presentation"></noscript></div></div></div></div></figure><p id="76e8" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">Now we work on fetching the metadata we want to get from a web page, let‚Äôs create a post route to receive the id and URL from the front end once the add button is clicked.</p><p id="d6bc" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">In the request body, we are expecting a value from previewUrl and id</p><pre class="fw fx fy fz ga kb kc kd"><span id="3822" class="ke hz dc bk ir b eg kf kg r kh">app.post('/get-preview',(req, res) =&gt; {<br>  const { previewUrl, id } = req.body;<br>  console.log(previewUrl); //<a class="at cg hp hq hr hs" target="_blank" rel="noopener" href="/@adoolak/how-to-deploy-a-reactjs-and-express-app-to-heroku-afb5b117e0eb">https://medium.com/@adoolak/how-to-deploy-a-reactjs-and-express-app-to-heroku-afb5b117e0eb</a><br>  console.log(id);//"a60d491d-8c70-4620-aa18-111ae1abaea9"<br>});</span></pre><p id="e6e0" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">Let‚Äôs work on fetching the HTML page from my last medium post.</p><p id="ffc5" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">Make the anonymous function into an async/await function, and use the fetch API from the node-fetch module, then create a variable called html and give it the value of the fetch method (make sure you use the await keyword, to wait for a result from the fetch), pass it the previewUrl value from the request body, then chain a <code class="gn io ip iq ir b">.then(res =&gt; res.text())</code> to it.</p><p id="c972" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">Next, we use cheerio, remember cheerio is an <em class="in">implementation of </em>core jquery for the server side.</p><p id="67ab" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">Create a variable with the $ sign and give it the value of <code class="gn io ip iq ir b">cheerio.load(), </code>pass the html variable to the load method, you can now try and select an html element using the $ sign.</p><pre class="fw fx fy fz ga kb kc kd"><span id="7303" class="ke hz dc bk ir b eg kf kg r kh">app.post('/get-preview',async (req, res) =&gt; {<br>  const { previewUrl, id } = req.body;<br>  const html = await fetch(previewUrl).then(res =&gt; res.text());<br>  const $ = cheerio.load(html);<br>  console.log($('h1').text()) //How to deploy a Reactjs and Express App to Heroku</span><span id="be91" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">});</span></pre><p id="863c" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">We can now start getting the meta tags we want, create a variable named <code class="gn io ip iq ir b">metaTagData</code> which will hold an object of the data,</p><p id="d2a6" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu"><strong class="ha ka">id</strong> ‚Äî we will pass in the id from <code class="gn io ip iq ir b">req.body</code> to the object,</p><p id="3b0e" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu"><strong class="ha ka">url</strong> ‚Äî the web site url to the url key.</p><p id="6528" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu"><strong class="ha ka">domain</strong> ‚Äî For the domain we just need the domain name of the previewUrl, we can use the url module from nodejs to get the hostname.</p><p id="0cef" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu"><strong class="ha ka">title</strong> ‚Äî use cheerio to select the meta tag with the attribute of <code class="gn io ip iq ir b">name="title"</code></p><p id="3cde" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu"><strong class="ha ka">img</strong>‚Äî use cheerio to select the meta tag with the attribute of <code class="gn io ip iq ir b">name="title"</code></p><p id="2d0a" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu"><strong class="ha ka">description</strong>‚Äî use cheerio to select the meta tag with the attribute of <code class="gn io ip iq ir b">name="description"</code> and get the attribute of <code class="gn io ip iq ir b">content</code> .</p><p id="16eb" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">The meta tags have another attribute called <code class="gn io ip iq ir b">content</code> that's where the values are stored, to get the values, you need to chain the cheerio selectors with the <code class="gn io ip iq ir b">attr</code> method and pass it the string of <code class="gn io ip iq ir b">content</code> .</p><p id="0a77" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">You should end with an object like this.</p><pre class="fw fx fy fz ga kb kc kd"><span id="5eea" class="ke hz dc bk ir b eg kf kg r kh">const metaTagData = {<br>  id:id,<br>  url: previewUrl,<br>  domain: url.parse(previewUrl).hostname,<br>  title: $('meta[name="title"]').attr('content'),<br>  img: $('meta[name="image"]').attr('content'),<br>  description: $('meta[name="description"]').attr('content'),<br>}</span></pre><p id="d8d6" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">Now, this should do it, but some web pages use a basic html meta tag, some use open graph, some use twitter cards, some use the property attribute instead of the name attribute, some don't add a image meta tag, we can basically end up with missing data or no data at all.</p><p id="3e33" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu"><strong class="ha ka">Solution</strong></p><p id="0e24" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">Creating a function which will return the first thing it finds</p><pre class="fw fx fy fz ga kb kc kd"><span id="eb2c" class="ke hz dc bk ir b eg kf kg r kh">const getMetaRag = (name) =&gt;  {</span><span id="ac58" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">  return(<br>    $(`meta[name=${name}]`).attr('content') ||<br>    $(`meta[name="og:${name}"]`).attr('content') ||<br>    $(`meta[name="twitter:${name}"]`).attr('content') ||<br>    $(`meta[property=${name}]`).attr('content') ||<br>    $(`meta[property="og:${name}"]`).attr('content') ||<br>    $(`meta[property="twitter:${name}"]`).attr('content')<br>  );</span><span id="066f" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">}</span></pre><p id="069a" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">We can now change the value of title, img and description of our metaTagData object to the getMetaTag function and pass it a the meta tag name as a string.</p><p id="8ca9" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">And what if a web page doesn't use meta tags at all ?</p><p id="fa56" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">We add a fallback value on our title, img and description keys.</p><pre class="fw fx fy fz ga kb kc kd"><span id="3b6b" class="ke hz dc bk ir b eg kf kg r kh">const metaTagData = {<br>  id:id,<br>  url: previewUrl,<br>  domain: url.parse(previewUrl).hostname,<br>  title: getMetaTag('title') || $(`h1`).text(),<br>  img: getMetaTag('image') || './images/no-image.png',<br>  description: getMetaTag('description') || $(`p`).text(),<br>}</span></pre><p id="99f3" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu"><strong class="ha ka">title</strong> ‚Äî will fall back to the first h1 tag on the page</p><p id="8241" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu"><strong class="ha ka">img</strong> ‚Äî will fall back to an image in the public/images folder</p><p id="d77e" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu"><strong class="ha ka">description</strong> ‚Äî will fall back to the first paragraph tag on the page</p><p id="fbfe" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">Some descriptions can get a bit lengthy, I decided to keep all descriptions at a max of 200 character count.</p><pre class="fw fx fy fz ga kb kc kd"><span id="ca77" class="ke hz dc bk ir b eg kf kg r kh">let { description } = metaTagData;</span><span id="c230" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">if(description.length &gt; 200){<br> metaTagData.description = description.substring(0,200) + '...';<br>}</span></pre><p id="3db7" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">Next, we push the data to the beginning of the data array, using the unshift array method, then write it to the <code class="gn io ip iq ir b">data.json</code> file using the <code class="gn io ip iq ir b">writeFile</code> from the fs (file system) nodejs module.</p><pre class="fw fx fy fz ga kb kc kd"><span id="7064" class="ke hz dc bk ir b eg kf kg r kh">data.unshift(metaTagData);</span><span id="3f8b" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">fs.writeFile("./data.json", JSON.stringify(data, null, 2),()=&gt;{<br>  res.status(201).json(data.shift());<br>});</span></pre><p id="bb56" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">The first parameter of the <code class="gn io ip iq ir b">writeFile</code> method takes in the file location, the second parameter we pass in the data we want to write to the file, since its a JSON file we need to stringify the data using the<code class="gn io ip iq ir b">JSON.stringify</code> method, the third parameter takes in a call back function, where we respond back with JSON and passing it the data using the shift array method and also set the HTTP status to 201.</p><p id="e09c" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu"><strong class="ha ka">Test Run!</strong></p><p id="a598" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">If you start your app, and past a link of any web page then click on add, you should end up with this.</p><figure class="fw fx fy fz ga fm cl cm paragraph-image"><div class="gd ge gf gg ak"><div class="cl cm kp"><div class="gm r gf gn"><div class="kq r"><div class="gh gi cp t u gj ak eh gk gl"><img class="cp t u gj ak gp gq gr" src="https://miro.medium.com/freeze/max/60/1*UQiIXwzOZvzCzpIRAj4hCQ.gif?q=20" width="990" height="928" role="presentation"></div><img class="gh gi cp t u gj ak gs" width="990" height="928" role="presentation"><noscript><img class="cp t u gj ak" src="https://miro.medium.com/max/1980/1*UQiIXwzOZvzCzpIRAj4hCQ.gif" width="990" height="928" role="presentation"></noscript></div></div></div></div></figure><p id="acba" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu"><strong class="ha ka">Deleting the card</strong></p><p id="959f" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">To remove a card, create another post route which will accept an ID from the URL parameter, create a variable named indexOfId and the value you map over the data json array and return the just the id of each object, then chaining the array method <code class="gn io ip iq ir b">indexOf()</code> to the map, will give you the exact position of the id you want to remove from the array (make sure you pass in the id from the url parameter to the indexOf method).</p><p id="590a" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">Next, we use the splice array method to remove the data from the data json array and passing the first parameter the <code class="gn io ip iq ir b">indexOfId</code> variable and second parameter the value <code class="gn io ip iq ir b">1</code> , indicating we want to remove just the object from the array.</p><p id="4a89" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">Then we use the fs nodejs module to rewrite the new edited data to the <code class="gn io ip iq ir b">data.json</code> file, and respond back with a status of 200 and using the respond <code class="gn io ip iq ir b">end()</code> to end the request.</p><pre class="fw fx fy fz ga kb kc kd"><span id="8e6d" class="ke hz dc bk ir b eg kf kg r kh">app.post('/remove/:id', (req, res) =&gt; {</span><span id="a4bc" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">  const { id } = req.params;</span><span id="abf2" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">  const indexOfId = data.map(dataId =&gt; dataId.id)</span><span id="e84e" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">.indexOf(id);</span><span id="c9a5" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">  data.splice(indexOfId,1);</span><span id="9698" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">  fs.writeFile("./data.json", JSON.stringify(data, null, 2), () =&gt; (</span><span id="7603" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">  res.status(200).end()</span><span id="3d07" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">  ));</span><span id="2bd7" class="ke hz dc bk ir b eg ki kj kk kl km kg r kh">});</span></pre><p id="8f80" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu"><strong class="ha ka">Test Run!</strong></p><p id="8450" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">If you try and remove a card, then refresh the page, the removed cards will it will no longer be there.</p><figure class="fw fx fy fz ga fm cl cm paragraph-image"><div class="gd ge gf gg ak"><div class="cl cm kp"><div class="gm r gf gn"><div class="kq r"><div class="gh gi cp t u gj ak eh gk gl"><img class="cp t u gj ak gp gq gr" src="https://miro.medium.com/freeze/max/60/1*BgEhnOulIwCpfOkp78Qawg.gif?q=20" width="990" height="928" role="presentation"></div><img class="gh gi cp t u gj ak gs" width="990" height="928" role="presentation"><noscript><img class="cp t u gj ak" src="https://miro.medium.com/max/1980/1*BgEhnOulIwCpfOkp78Qawg.gif" width="990" height="928" role="presentation"></noscript></div></div></div></div></figure><h2 id="bc3f" class="ke hz dc bk bj ia kr ks kt ku kv kw kx ky kz la lb">End Of The Road!!</h2><h2 id="6773" class="ke hz dc bk bj ia kr ks kt ku kv kw kx ky kz la lb">Conclusion</h2><p id="60e3" class="gy gz dc bk ha b hb js hd jt hf ju hh jv hj jw hl cu">We learned how to create a link preview by web scraping meta tags, but with the power of web scraping, you can do more than scrap meta tags.</p><p id="4751" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">Take Adidas as an example, they don't prove an API for their product, images, prices, etc‚Ä¶, and you want to create an eCommerce side project.</p><p id="cb34" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">You can go to their web page and start scraping the products, but if a web page like adidas.com uses react, angular or vue, it can get complicated to web scrap.</p><p id="b9e4" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu">You will need to use a headless browser to get around scraping that kind of web sites.</p><p id="e448" class="gy gz dc bk ha b hb hc hd he hf hg hh hi hj hk hl cu"><strong class="ha ka"><em class="in">!!! Watch out though, it is illegal to scrap some web sites !!!</em></strong></p><h2 id="7e3a" class="ke hz dc bk bj ia kr ks kt ku kv kw kx ky kz la lb">Headless browser resources</h2><div class="is it iu iv iw ix"><a rel="noopener" href="/swlh/an-introduction-to-web-scraping-with-puppeteer-3d35a51fdca0"><div class="ja n ar"><div class="jb n co p jc jd"><h2 class="bj ia je bl dc"><div class="eh iy ej ek iz em">An Introduction to Web Scraping with Puppeteer</div></h2><div class="jf r"><h3 class="bj ef eg bl bo"><div class="eh iy ej ek iz em">Learn Puppeteer with me in this article.</div></h3></div><div class="jg r"><h4 class="bj ef fb bl bo"><div class="eh iy ej ek iz em">medium.com</div></h4></div></div><div class="jh r"><div class="lc r jj jk jl jh jm jn jo"></div></div></div></a></div><div class="is it iu iv iw ix"><a href="https://codeburst.io/a-guide-to-automating-scraping-the-web-with-javascript-chrome-puppeteer-node-js-b18efb9e9921" rel="noopener"><div class="ja n ar"><div class="jb n co p jc jd"><h2 class="bj ia je bl dc"><div class="eh iy ej ek iz em">A Guide to Automating &amp; Scraping the Web with JavaScript (Chrome + Puppeteer + Node JS)</div></h2><div class="jf r"><h3 class="bj ef eg bl bo"><div class="eh iy ej ek iz em">Learn to Automate and Scrape the web with Headless Chrome</div></h3></div><div class="jg r"><h4 class="bj ef fb bl bo"><div class="eh iy ej ek iz em">codeburst.io</div></h4></div></div><div class="jh r"><div class="ld r jj jk jl jh jm jn jo"></div></div></div></a></div><div class="is it iu iv iw ix"><a rel="noopener" href="/@lynzt/scraping-using-zombie-js-8fb2877348fd"><div class="ja n ar"><div class="jb n co p jc jd"><h2 class="bj ia je bl dc"><div class="eh iy ej ek iz em">Scraping using zombie.js</div></h2><div class="jf r"><h3 class="bj ef eg bl bo"><div class="eh iy ej ek iz em">I‚Äôm using zombie for testing and want to pull back a list of anchor tags (so not really scraping but a common thing you‚Ä¶</div></h3></div><div class="jg r"><h4 class="bj ef fb bl bo"><div class="eh iy ej ek iz em">medium.com</div></h4></div></div></div></a></div><blockquote class="ik il im"><p id="faa2" class="gy gz dc in ha b hb hc hd he hf hg hh hi hj hk hl cu">Got any questions ?<br>DM me in twitter @Adel_xoxo and I‚Äôll answer to the best of my knowledge</p><p id="533e" class="gy gz dc in ha b hb hc hd he hf hg hh hi hj hk hl cu">~Adel ak</p></blockquote>