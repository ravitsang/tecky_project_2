<p id="7d3e" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">For many people, data scraping or web scraping is to write some programs that click websites and copy information from them. While this is a legitimate way to do scraping, it is the least efficient method.</p><p id="2002" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">In this article, I will list a few methods I used in scraping data from less efficient ones to more efficient ones.</p><h1 id="62cd" class="ga gb dc bk bj gc de gd dg ge gf gg gh gi gj gk gl">Understanding the Request Response Cycle</h1><p id="aa07" class="fm fn dc bk fo b fp gm fr gn ft go fv gp fx gq fz cu">Put it in a very simple way, the web is a place where a lot of requests and responses happening. A client (user) requests information from a server (which is just another computer). And the server serves the information (response) back to the client.</p><p id="0fc5" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">What you see as a client on a browser is just a bunch of data parsed and formatted in a pretty and presentable way, thanks to HTML, CSS, and JavaScript. The key here is the line: “just a bunch of data” which means we may be able to scrape it.</p><p id="8bd1" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">There is a subtle detail which may affect the technique to scrape data. Sometimes, the whole webpage is rendered in the server side which means the server sends the complete HTML, CSS and JavaScript to the client and the client’s browser displays it. The other way is that the server returns the data and the client browser is responsible for parsing it. For the websites which is rendered in server side, we can only scrape by HTML elements . For the websites which is rendered in the client side, we can scrape by a more efficient method.</p><p id="70ac" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">Actually, the key to efficient scraping is to find a place where data is rendered in the client side. For example, you may find that in a website, the data is rendered in server. But you also find that the company provides an android app. It is very likely that for an android app, the data is rendered in the client side. This enable us to use a more efficient method.</p><p id="62c9" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">Don’t underestimate the difference. Scraping HTML elements are usually very slow!</p><h1 id="8b45" class="ga gb dc bk bj gc de gd dg ge gf gg gh gi gj gk gl">Server Side: Scraping HTML elements</h1><p id="44f7" class="fm fn dc bk fo b fp gm fr gn ft go fv gp fx gq fz cu">A script will send a request to the server. Server responses with the HTML file. Then the script find the location of information and extract it.</p><h2 id="4f67" class="gr gb dc bk bj gc gs gt gu gv gw gx gy gz ha hb hc">Pros:</h2><ul class=""><li id="e0b8" class="fm fn dc bk fo b fp gm fr gn ft go fv gp fx gq fz hd he hf">Easy to implement</li><li id="8f33" class="fm fn dc bk fo b fp hg fr hh ft hi fv hj fx hk fz hd he hf">Straight-forward</li></ul><h2 id="eb11" class="gr gb dc bk bj gc gs gt gu gv gw gx gy gz ha hb hc">Cons:</h2><ul class=""><li id="addf" class="fm fn dc bk fo b fp gm fr gn ft go fv gp fx gq fz hd he hf">Slow for scraping large amount of webpages</li><li id="84ef" class="fm fn dc bk fo b fp hg fr hh ft hi fv hj fx hk fz hd he hf">Not robust. Webpages change</li><li id="351c" class="fm fn dc bk fo b fp hg fr hh ft hi fv hj fx hk fz hd he hf">Development time is long. You need to hard code the location of information.</li></ul><h2 id="64cc" class="gr gb dc bk bj gc gs gt gu gv gw gx gy gz ha hb hc">Tools:</h2><ul class=""><li id="9735" class="fm fn dc bk fo b fp gm fr gn ft go fv gp fx gq fz hd he hf"><a href="https://scrapy.org/" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Scrapy</a></li><li id="6662" class="fm fn dc bk fo b fp hg fr hh ft hi fv hj fx hk fz hd he hf"><a href="https://www.seleniumhq.org/" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Selenium</a></li></ul><h1 id="6e9e" class="ga gb dc bk bj gc de gd dg ge gf gg gh gi gj gk gl">Client Side: Scraping the responded data</h1><p id="e379" class="fm fn dc bk fo b fp gm fr gn ft go fv gp fx gq fz cu">A script will send a request to the server. Server responses with data, usually JSON, XML. Then the script extracts the useful information or store the responded data directly.</p><p id="3cca" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">Usually people we look at the Network Tab in the developer tool (Firefox) to inspect the traffic. <a href="https://mitmproxy.org/" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Mitmproxy </a>may also be used for more detail analysis.</p><figure class="hq hr hs ht hu hv cl cm paragraph-image"><div class="hw hx hy hz ak"><div class="cl cm hp"><div class="if r hy ig"><div class="ih r"><div class="ia ib cp t u ic ak eh id ie"><img class="cp t u ic ak ii ij ik" src="https://miro.medium.com/max/60/1*WTy8lGHaZNQfb0zhN-zNjg.png?q=20" width="1857" height="984" role="presentation"></div><img class="ia ib cp t u ic ak il" width="1857" height="984" role="presentation"><noscript><img class="cp t u ic ak" src="https://miro.medium.com/max/3714/1*WTy8lGHaZNQfb0zhN-zNjg.png" width="1857" height="984" role="presentation"></noscript></div></div></div></div><figcaption class="bo eg im in io cn cl cm ip iq bj ef">Network Tab (Firefox)</figcaption></figure><h2 id="a6fd" class="gr gb dc bk bj gc gs gt gu gv gw gx gy gz ha hb hc">Pros:</h2><ul class=""><li id="e2c1" class="fm fn dc bk fo b fp gm fr gn ft go fv gp fx gq fz hd he hf">Fast for scraping large amount of webpage</li><li id="6462" class="fm fn dc bk fo b fp hg fr hh ft hi fv hj fx hk fz hd he hf">Robust. Usually the request endpoints will not change.</li><li id="7028" class="fm fn dc bk fo b fp hg fr hh ft hi fv hj fx hk fz hd he hf">Fast development. Less code to write.</li></ul><h2 id="9650" class="gr gb dc bk bj gc gs gt gu gv gw gx gy gz ha hb hc">Cons:</h2><ul class=""><li id="c764" class="fm fn dc bk fo b fp gm fr gn ft go fv gp fx gq fz hd he hf">Take some experience to find it.</li><li id="c2d2" class="fm fn dc bk fo b fp hg fr hh ft hi fv hj fx hk fz hd he hf">Authentication issue. Sometimes the webpage is protected by password. You need to understand the authentication mechanism to get in.</li></ul><h2 id="b5f2" class="gr gb dc bk bj gc gs gt gu gv gw gx gy gz ha hb hc">Tools:</h2><ul class=""><li id="6ce9" class="fm fn dc bk fo b fp gm fr gn ft go fv gp fx gq fz hd he hf"><a href="https://scrapy.org/" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Scrapy</a></li><li id="4c99" class="fm fn dc bk fo b fp hg fr hh ft hi fv hj fx hk fz hd he hf"><a href="https://pypi.org/project/requests/" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">Requests</a></li></ul><h1 id="412a" class="ga gb dc bk bj gc de gd dg ge gf gg gh gi gj gk gl">Special Tricks: Scraping APPs</h1><p id="0122" class="fm fn dc bk fo b fp gm fr gn ft go fv gp fx gq fz cu">This is a special tricks I used to scrape webpage that renders in server side. But it only works if the company provides an Android app (Haven’t tried it on IOS app).</p><p id="1b39" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">The steps go like this:</p><ol class=""><li id="df68" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz ir he hf">Download the APK file and add security exception to APK. Since Android 7.0, google introduced changed to Certificate Authorities (CA) settings which prevents third-parties listening to network requests. Luckily you can find a script to add the exception automatically <a href="https://github.com/levyitay/AddSecurityExceptionAndroid" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">here</a>.</li><li id="b89c" class="fm fn dc bk fo b fp hg fr hh ft hi fv hj fx hk fz ir he hf">Install the modified APK to your phone</li><li id="67cf" class="fm fn dc bk fo b fp hg fr hh ft hi fv hj fx hk fz ir he hf">Set up the man-in-the-middle proxy (MitmProxy) and your phone. You can refer to this <a class="at cg hl hm hn ho" target="_blank" rel="noopener" href="/testvagrant/intercept-ios-android-network-calls-using-mitmproxy-4d3c94831f62">article</a>.</li><li id="14b9" class="fm fn dc bk fo b fp hg fr hh ft hi fv hj fx hk fz ir he hf">Inspect the traffic and look for the data you want.</li></ol><p id="29e1" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">For example, I want to scrape Centaline Property Website. After inspecting the webpage, I found that it seems like data is rendered in the server side.</p><figure class="hq hr hs ht hu hv cl cm paragraph-image"><div class="hw hx hy hz ak"><div class="cl cm is"><div class="if r hy ig"><div class="it r"><div class="ia ib cp t u ic ak eh id ie"><img class="cp t u ic ak ii ij ik" src="https://miro.medium.com/max/60/1*jBa2It730cM5ZD-EYoo1Tw.png?q=20" width="1060" height="920" role="presentation"></div><img class="ia ib cp t u ic ak il" width="1060" height="920" role="presentation"><noscript><img class="cp t u ic ak" src="https://miro.medium.com/max/2120/1*jBa2It730cM5ZD-EYoo1Tw.png" width="1060" height="920" role="presentation"></noscript></div></div></div></div><figcaption class="bo eg im in io cn cl cm ip iq bj ef">Centaline Web (server side render)</figcaption></figure><p id="6f91" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">But, they provided an android app. After using the above steps, I managed to find the data which is requested (POST) using</p><p id="01ce" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu"><a href="https://hkapi.centanet.com/api/FindProperty/MapV2.json?postType=s&amp;order=desc&amp;page=1&amp;pageSize=20&amp;pixelHeight=2220&amp;pixelWidth=1080&amp;points%5B0%5D.lat=22.705635288642362&amp;points%5B0%5D.lng=113.85844465345144&amp;points%5B1%5D.lat=22.705635288642362&amp;points%5B1%5D.lng=114.38281349837781&amp;points%5B2%5D.lat=21.993328259196705&amp;points%5B2%5D.lng=114.38281349837781&amp;points%5B3%5D.lat=21.993328259196705&amp;points%5B3%5D.lng=113.85844465345144&amp;sort=score&amp;zoom=9.745128631591797&amp;platform=android" class="at cg hl hm hn ho" target="_blank" rel="noopener nofollow">https://hkapi.centanet.com/api/FindProperty/MapV2.json?postType=s&amp;order=desc&amp;page=1&amp;pageSize=20&amp;pixelHeight=2220&amp;pixelWidth=1080&amp;points[0].lat=22.705635288642362&amp;points[0].lng=113.85844465345144&amp;points[1].lat=22.705635288642362&amp;points[1].lng=114.38281349837781&amp;points[2].lat=21.993328259196705&amp;points[2].lng=114.38281349837781&amp;points[3].lat=21.993328259196705&amp;points[3].lng=113.85844465345144&amp;sort=score&amp;zoom=9.745128631591797&amp;platform=android</a></p><h1 id="7c95" class="ga gb dc bk bj gc de gd dg ge gf gg gh gi gj gk gl">Conclusion</h1><p id="a170" class="fm fn dc bk fo b fp gm fr gn ft go fv gp fx gq fz cu">I cannot go into very detail in the steps. The article is quite long already. The message here is that try not to use HTML element in the first place. Always look for client side render service. This will improve your scraping efficiency greatly.</p><p id="1e01" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">However, something that is working is always better than nothing. If you really can’t find a better way at this moment, just use HTML element and keep looking for better solution!</p>