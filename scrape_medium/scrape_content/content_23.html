<div class="gr gs gt gu gv gw ag gx ah gy aj ak"><figure class="ha hb hc hd he gq hf hg paragraph-image"><div class="hh hi hj hk ak"><div class="do dp gz"><div class="hq r hj hr"><div class="hs r"><div class="hl hm ds t u hn ak cd ho hp"><img class="ds t u hn ak ht hu hv" src="https://miro.medium.com/max/60/1*aPhII8tpOj9XsXXQNngPzw.jpeg?q=20" width="5184" height="3456" role="presentation"></div><img class="hl hm ds t u hn ak hw" width="5184" height="3456" role="presentation"><noscript><img class="ds t u hn ak" src="https://miro.medium.com/max/10368/1*aPhII8tpOj9XsXXQNngPzw.jpeg" width="5184" height="3456" role="presentation"></noscript></div></div></div></div><figcaption class="ax fi hx hy hz dq do dp ia ib as cx"><a href="https://unsplash.com/photos/-lp8sTmF9HA" class="dc by ic id ie if" target="_blank" rel="noopener nofollow">https://unsplash.com/photos/-lp8sTmF9HA</a></figcaption></figure></div><p id="c774" class="ig ih ef at ii b ij ik il im in io ip iq ir is it dx">In this article, we will see how to do web scraping with R while doing so, we’ll leverage functional programming in R to scale it up. The nature of the article is more like a cookbook-format rather than a documentation/tutorial-type, because the objective here is to explain how effectively web scraping can be coupled with Functional Programming</p><h2 id="4dfd" class="iu iv ef at as iw ix iy iz ja jb jc jd je jf jg jh"><strong class="bf">Web Scraping in R</strong></h2><p id="de47" class="ig ih ef at ii b ij ji il jj in jk ip jl ir jm it dx">Web scraping needs no introduction among Data enthusiasts. It’s one of the most viable and most essential ways of collecting Data when the data itself isn’t available.</p><p id="2026" class="ig ih ef at ii b ij ik il im in io ip iq ir is it dx">Knowing web scraping comes very handy when you are in shortage of data or in need of Macroeconomics indicators or simply no data available for a particular project like a Word2vec / Language with a custom text dataset.</p><p id="73c1" class="ig ih ef at ii b ij ik il im in io ip iq ir is it dx"><code class="hr jn jo jp jq b">rvest</code> a beautiful (like BeautifulSoup in Python) package in R for web scraping. It also goes very well with the universe of <code class="hr jn jo jp jq b">tidyverse</code> and the super-handy <code class="hr jn jo jp jq b">%&gt;%</code> pipe operator.</p><h2 id="e1cc" class="iu iv ef at as iw ix iy iz ja jb jc jd je jf jg jh"><strong class="bf">Sample Use-case</strong></h2><p id="2a8d" class="ig ih ef at ii b ij ji il jj in jk ip jl ir jm it dx">Text Analysis of how customers feel about Etsy.com. For this, we are going to extract reviews data from <a href="http://trustpilot.com" class="dc by ic id ie if" target="_blank" rel="noopener nofollow">trustpilot.com</a>.</p><p id="1479" class="ig ih ef at ii b ij ik il im in io ip iq ir is it dx">Below is the R code for scraping reviews from the first page of Trustpilot’s Etsy page. <a href="https://www.trustpilot.com/review/www.etsy.com?page=1" class="dc by ic id ie if" target="_blank" rel="noopener nofollow">URL: https://www.trustpilot.com/review/www.etsy.com?page=1</a></p><pre class="ha hb hc hd he jr js cm"><span id="d822" class="iu iv ef at jq b fi jt ju r jv">library(tidyverse) #for data manipulation - here for pipe<br>library(rvest) - for web scraping</span><span id="6d78" class="iu iv ef at jq b fi jw jx jy jz ka ju r jv">#single-page scraping</span><span id="22d8" class="iu iv ef at jq b fi jw jx jy jz ka ju r jv">url &lt;- "<a href="https://www.trustpilot.com/review/www.etsy.com?page=1" class="dc by ic id ie if" target="_blank" rel="noopener nofollow">https://www.trustpilot.com/review/www.etsy.com?page=1</a>"</span><span id="15eb" class="iu iv ef at jq b fi jw jx jy jz ka ju r jv">url %&gt;% <br>  read_html() %&gt;% <br>  html_nodes(".review-content__text") %&gt;% <br>  html_text() -&gt; reviews</span></pre><p id="022d" class="ig ih ef at ii b ij ik il im in io ip iq ir is it dx">This is fairly a straightforward code where we pass on the URL to read the html content. Once the content is read, we use <code class="hr jn jo jp jq b">html_nodes</code> function to get the reviews text based on its <code class="hr jn jo jp jq b">css selector property</code> and finally just taking the text out of it <code class="hr jn jo jp jq b">html_text()</code> and assigning it to the R object <code class="hr jn jo jp jq b">reviews</code> .</p><p id="a97a" class="ig ih ef at ii b ij ik il im in io ip iq ir is it dx">Below is the sample output of <code class="hr jn jo jp jq b">reviews</code>:</p><figure class="ha hb hc hd he gq do dp paragraph-image"><div class="hh hi hj hk ak"><div class="do dp kb"><div class="hq r hj hr"><div class="kc r"><div class="hl hm ds t u hn ak cd ho hp"><img class="ds t u hn ak ht hu hv" src="https://miro.medium.com/max/60/1*NfimrAbyjQFZ7icNctmTrw.png?q=20" width="2554" height="1770" role="presentation"></div><img class="hl hm ds t u hn ak hw" width="2554" height="1770" role="presentation"><noscript><img class="ds t u hn ak" src="https://miro.medium.com/max/5108/1*NfimrAbyjQFZ7icNctmTrw.png" width="2554" height="1770" role="presentation"></noscript></div></div></div></div></figure><p id="92ea" class="ig ih ef at ii b ij ik il im in io ip iq ir is it dx">Well and Good. We’ve successfully scraped the reviews we wanted for our Analysis.</p><figure class="ha hb hc hd he gq hw ke bv kf kg kh ki kj bg kk kl km kn ko kp paragraph-image"><div class="do dp kd"><div class="hq r hj hr"><div class="kq r"><div class="hl hm ds t u hn ak cd ho hp"><img class="ds t u hn ak ht hu hv" src="https://miro.medium.com/max/60/1*zeuLPCYv_9AIn7Gz6VpeNQ.png?q=20" width="474" height="188" role="presentation"></div><img class="hl hm ds t u hn ak hw" width="474" height="188" role="presentation"><noscript><img class="ds t u hn ak" src="https://miro.medium.com/max/948/1*zeuLPCYv_9AIn7Gz6VpeNQ.png" width="474" height="188" role="presentation"></noscript></div></div></div></figure><p id="2d22" class="ig ih ef at ii b ij ik il im in io ip iq ir is it dx">But the catch is the amount of reviews we’ve got is just 20 reviews — in that as we can see in the screenshot we’ve already got a non-English review that we might have to exclude in the data cleaning process.</p><p id="55eb" class="ig ih ef at ii b ij ik il im in io ip iq ir is it dx">This all puts us in a situation to collect more data to compensate the above mentioned data loss and make the analysis more effective.</p><h2 id="1d42" class="iu iv ef at as iw ix iy iz ja jb jc jd je jf jg jh">Need for Scale</h2><p id="46ea" class="ig ih ef at ii b ij ji il jj in jk ip jl ir jm it dx">With the above code, we had scraped only from the first page (which is the most recent). So, Due to the need for more data, we have to expand our search to further pages, let’s say 10 other pages which will give us 200 raw reviews to work with before data processing.</p><h2 id="097c" class="iu iv ef at as iw ix iy iz ja jb jc jd je jf jg jh">Conventional Way</h2><p id="fdf0" class="ig ih ef at ii b ij ji il jj in jk ip jl ir jm it dx">The very conventional way of doing this is to use a loop — typically <code class="hr jn jo jp jq b">for</code>loop to iterate the URL from 1 to 20 to create 20 different URLs (String Concatenation at work) based on a base url. As we all know that’s more computationally intensive and the code wouldn’t be compact either.</p><h2 id="c4aa" class="iu iv ef at as iw ix iy iz ja jb jc jd je jf jg jh"><strong class="bf">The Functional Programming way</strong></h2><p id="a2e1" class="ig ih ef at ii b ij ji il jj in jk ip jl ir jm it dx">This is where we are going to use R’s functional programming support from the package <code class="hr jn jo jp jq b">purrr</code> to perform the same iteration but quite in R’s <code class="hr jn jo jp jq b">tidy</code> way within the same data pipeline as the above code. We’re going to use two functions from <code class="hr jn jo jp jq b">purrr</code> ,</p><ol class=""><li id="9b52" class="ig ih ef at ii b ij ik il im in io ip iq ir is it kr ks kt"><code class="hr jn jo jp jq b">map()</code> is the typical map from the functional programming paradigm, that takes a function and maps onto a series of values.</li><li id="a294" class="ig ih ef at ii b ij ku il kv in kw ip kx ir ky it kr ks kt"><code class="hr jn jo jp jq b">map2_chr()</code> is the evolution of map that takes additional arguments for the function and formats the output as a character.</li></ol><p id="021e" class="ig ih ef at ii b ij ik il im in io ip iq ir is it dx"><strong class="ii kz">Below is our Functional Programming Code</strong></p><pre class="ha hb hc hd he jr js cm"><span id="dad6" class="iu iv ef at jq b fi jt ju r jv">library(tidyverse)<br>library(rvest)<br>library(purrr)</span><span id="5c57" class="iu iv ef at jq b fi jw jx jy jz ka ju r jv">#multi-page</span><span id="c63b" class="iu iv ef at jq b fi jw jx jy jz ka ju r jv">url &lt;- "<a href="https://www.trustpilot.com/review/www.etsy.com?page=" class="dc by ic id ie if" target="_blank" rel="noopener nofollow">https://www.trustpilot.com/review/www.etsy.com?page=</a>" #base URL without the page number</span><span id="eadf" class="iu iv ef at jq b fi jw jx jy jz ka ju r jv">url %&gt;% <br>  map2_chr(1:10,paste0) %&gt;% #for building 20 URLs <br>  map(. %&gt;% <br>    read_html() %&gt;% <br>      html_nodes(".review-content__text") %&gt;% <br>      html_text()<br>  ) %&gt;% <br>  unlist() -&gt; more_reviews</span></pre><p id="c81f" class="ig ih ef at ii b ij ik il im in io ip iq ir is it dx">As you can see, this code is very similar to the above single-page code and hence it makes it easier for anyone who understand the previous code to read this through with minimal prior knowledge.</p><p id="37e7" class="ig ih ef at ii b ij ik il im in io ip iq ir is it dx">The additional operations in this code is that we build 20 new URLs (by changing the query value of the URL) and pass on those 20 URLs one-by-one for web scraping and finally as we’d get a list in return, we use <code class="hr jn jo jp jq b">unlist</code> to save all the reviews whose count must be 200 (20 reviews per page x 10 pages).</p><p id="fe5f" class="ig ih ef at ii b ij ik il im in io ip iq ir is it dx">Let’s check how the output looks:</p><figure class="ha hb hc hd he gq do dp paragraph-image"><div class="hh hi hj hk ak"><div class="do dp la"><div class="hq r hj hr"><div class="lb r"><div class="hl hm ds t u hn ak cd ho hp"><img class="ds t u hn ak ht hu hv" src="https://miro.medium.com/max/60/1*gb-oTtYRXoBMBQ4_j83-dA.png?q=20" width="2586" height="912" role="presentation"></div><img class="hl hm ds t u hn ak hw" width="2586" height="912" role="presentation"><noscript><img class="ds t u hn ak" src="https://miro.medium.com/max/5172/1*gb-oTtYRXoBMBQ4_j83-dA.png" width="2586" height="912" role="presentation"></noscript></div></div></div></div></figure><p id="6758" class="ig ih ef at ii b ij ik il im in io ip iq ir is it dx">Yes, 200 reviews it is. That fulfills our goal of collecting (fairly) sufficient data for performing the text analysis use-case we mentioned above.</p><p id="9ad1" class="ig ih ef at ii b ij ik il im in io ip iq ir is it dx">But the point of this article is to introduce you to the world of functional programming in R and to show how easily it fits in with the existing data pipeline / workflow and how compact it is and with a pinch of doubt, how efficient it is (than a typical for-loop). Hope, the article served its purpose.</p><ul class=""><li id="1654" class="ig ih ef at ii b ij ik il im in io ip iq ir is it lc ks kt"><strong class="ii kz">If you are more interested, Check out this </strong><a href="https://www.datacamp.com/courses/foundations-of-functional-programming-with-purrr?tap_a=5644-dce66f&amp;tap_s=210728-e54afe" class="dc by ic id ie if" target="_blank" rel="noopener nofollow"><strong class="ii kz">Datacamp course on Functional Programming with purrr</strong></a></li><li id="7828" class="ig ih ef at ii b ij ku il kv in kw ip kx ir ky it lc ks kt">The complete code used here is available <a href="https://github.com/amrrs/blogpost_codes/blob/master/rvest_purrr_scraping_at_scale.R" class="dc by ic id ie if" target="_blank" rel="noopener nofollow">here on github</a></li></ul><p id="51a0" class="ig ih ef at ii b ij ik il im in io ip iq ir is it dx"><em class="ld">Thanks: This entire article and code was inspired by the Session that Saurav Ghosh took in the Bengaluru R user group meetup</em></p>